<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NovaOS — Packages & Install</title>
  <style>
    :root{
      --purple-900: #2b0440;
      --purple-800: #3b0a56;
      --purple-700: #5b2a84;
      --purple-600: #7b4aae;
      --purple-500: #9b6fe0;
      --white: #ffffff;
      --muted: #e9e7f2;
      --glass: rgba(255,255,255,0.06);
      --accent: var(--purple-500);
      --radius: 12px;
      --shadow: 0 6px 18px rgba(16,8,30,0.45);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      min-height:100vh;
      color:var(--white);
      background: linear-gradient(180deg,var(--purple-900) 0%, #18021b 60%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:40px 20px;
    }

    .shell{
      width:100%;
      max-width:1100px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.04);
    }

    /* Top bar */
    header.topbar{
      display:flex;
      align-items:center;
      gap:16px;
      padding:20px 24px;
      background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-bottom:1px solid rgba(255,255,255,0.03);
    }

    .logo {
      display:flex;
      gap:12px;
      align-items:center;
    }

    .logo .mark{
      width:44px;
      height:44px;
      border-radius:10px;
      background: linear-gradient(135deg,var(--purple-700),var(--purple-500));
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      box-shadow:0 6px 16px rgba(155,111,224,0.2);
      color:var(--white);
      font-family:monospace;
    }

    .logo h1{
      font-size:1.05rem;
      margin:0;
      letter-spacing:0.3px;
    }

    .logo p{ margin:0; font-size:0.78rem; color:var(--muted); }

    nav.tabs{
      margin-left:auto;
      display:flex;
      gap:8px;
      align-items:center;
    }

    .tab{
      padding:8px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      background:transparent;
      color:var(--muted);
      border:1px solid transparent;
      transition: all 160ms ease;
    }

    .tab[aria-selected="true"]{
      background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      color:var(--white);
      box-shadow: 0 6px 18px rgba(64, 20, 84, 0.25);
      border:1px solid rgba(255,255,255,0.04);
    }

    /* layout */
    .main{
      display:grid;
      grid-template-columns: 1fr;
      gap:20px;
      padding:28px;
    }

    .hero {
      display:flex;
      gap:20px;
      align-items:center;
    }

    .hero .left{
      flex:1;
    }

    .hero h2{
      margin:0 0 10px 0;
      font-size:1.6rem;
      color:var(--white);
    }

    .hero p{
      margin:0 0 16px 0;
      color:var(--muted);
      line-height:1.45;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border-radius:12px;
      padding:14px;
      border:1px solid rgba(255,255,255,0.03);
      box-shadow: 0 8px 22px rgba(10,6,18,0.35);
    }

    .install-line{
      display:flex;
      gap:8px;
      align-items:center;
      width:100%;
    }

    .code{
      background:rgba(0,0,0,0.35);
      padding:10px 12px;
      border-radius:8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      font-size:0.95rem;
      color:var(--white);
      flex:1;
      user-select: all;
      overflow-wrap:anywhere;
    }

    .btn{
      background:var(--accent);
      color:var(--white);
      padding:10px 12px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
      min-width:90px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition:transform 120ms ease;
    }

    .btn:active{ transform:translateY(1px) }

    .small {
      padding:6px 8px;
      font-size:0.88rem;
      min-width:72px;
      border-radius:8px;
    }

    .muted {
      color:var(--muted);
      font-size:0.9rem;
    }

    /* packages grid */
    .packages-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
      gap:14px;
    }

    .pkg-card{
      display:flex;
      flex-direction:column;
      gap:8px;
      padding:12px;
      border-radius:10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.016), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      min-height:220px;
    }

    .pkg-thumb{
      height:110px;
      background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.02);
    }

    .pkg-thumb img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;
      display:block;
    }

    .pkg-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }

    .pkg-title h3{ margin:0; font-size:1rem; }
    .pkg-desc{ color:var(--muted); font-size:0.9rem; margin:0; line-height:1.3; flex:1; }

    .pkg-actions{
      display:flex;
      gap:8px;
      align-items:center;
      margin-top:6px;
    }

    .copy-toast{
      position:fixed;
      right:20px;
      bottom:20px;
      background:linear-gradient(90deg,var(--purple-700),var(--purple-500));
      color:var(--white);
      padding:8px 12px;
      border-radius:999px;
      box-shadow:0 8px 26px rgba(50,20,80,0.35);
      display:flex;
      gap:8px;
      align-items:center;
      z-index:40;
    }

    .loading {
      display:flex;
      gap:12px;
      align-items:center;
      color:var(--muted);
    }

    .spinner{
      width:16px;
      height:16px;
      border-radius:50%;
      border:2px solid rgba(255,255,255,0.06);
      border-top-color:var(--accent);
      animation:spin 900ms linear infinite;
    }
    @keyframes spin { to { transform:rotate(360deg) } }

    footer {
      padding:14px 24px;
      border-top:1px solid rgba(255,255,255,0.03);
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:var(--muted);
      font-size:0.88rem;
    }

    /* small screens */
    @media (max-width:640px){
      .hero { flex-direction:column; align-items:flex-start; gap:12px; }
      header.topbar { padding:14px }
      .logo h1{ font-size:0.95rem }
    }
  </style>
</head>
<body>
  <div class="shell" role="application" aria-label="NovaOS website">
    <header class="topbar">
      <div class="logo" aria-hidden="false">
        <div class="mark">N</div>
        <div>
          <h1>NovaOS</h1>
          <p>Full replacement for CraftOS — community packages</p>
        </div>
      </div>

      <nav class="tabs" role="tablist" aria-label="Main">
        <button class="tab" role="tab" aria-selected="true" data-tab="home" id="tab-home">Home</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="packages" id="tab-packages">Packages</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="about" id="tab-about">About</button>
      </nav>
    </header>

    <main class="main" id="main-content">
      <!-- HOME -->
      <section id="home" class="panel" role="tabpanel" aria-labelledby="tab-home">
        <div class="hero card">
          <div class="left">
            <h2>Nova OS — a full replacement for CraftOS</h2>
            <p>
              NovaOS is designed to be a drop-in replacement for CraftOS with a modern package
              workflow. Install the Nova installer on a machine running an environment with wget
              available, then use the <code style="background:transparent;padding:0;color:var(--muted)">nam</code> package manager
              to install packages.
            </p>

            <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center">
              <div style="width:100%; max-width:760px" class="card">
                <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap">
                  <div class="install-line" style="flex:1; min-width:0;">
                    <div class="code" id="installCmd" title="Click copy">wget https://fozogt-jpg.github.io/NovaShell/install</div>
                    <button class="btn small" id="copyInstall">Copy</button>
                  </div>
                </div>
                <div style="margin-top:10px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                  <div class="muted">Suggested usage:</div>
                  <div class="code" style="display:inline-block; padding:6px 10px; margin-left:6px; font-size:0.92rem;">sh install</div>
                  <div style="flex:1"></div>
                  <button id="openInstall" class="btn small" title="Open installer URL in a new tab">Open URL</button>
                </div>
              </div>
            </div>

            <div style="margin-top:14px" class="muted">
              Click <strong>Copy</strong> to copy the install command to your clipboard (it will copy the exact text shown).
            </div>
          </div>

          <aside style="width:320px; min-width:220px;">
            <div class="card" style="text-align:center;">
              <h3 style="margin:0 0 8px 0">Quick Start</h3>
              <p class="muted" style="margin:0 0 12px 0">
                1. Copy the installer command. <br>
                2. Run it on a machine with wget. <br>
                3. Use <code style="background:transparent">nam -i &lt;pkg&gt;</code> to install packages.
              </p>

              <div style="display:flex; gap:8px; justify-content:center;">
                <button class="btn" id="copyQuick">Copy nam -i &lt;pkg&gt;</button>
                <button class="btn small" id="showPackagesBtn">Browse packages</button>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <!-- PACKAGES -->
      <section id="packages" class="panel" role="tabpanel" aria-labelledby="tab-packages" hidden>
        <div style="display:flex; gap:12px; align-items:center; margin-bottom:12px;">
          <div style="flex:1;">
            <h2 style="margin:0">Packages</h2>
            <p class="muted" style="margin:4px 0 0 0">Packages are loaded from the community repository and can be installed with <code>nam -i &lt;package&gt;</code>.</p>
          </div>

          <div style="display:flex; gap:8px; align-items:center;">
            <div class="muted">Source:</div>
            <div class="code" style="padding:8px 10px; font-size:0.85rem;">https://fozogt-jpg.github.io/NovaShell/packages/npkg.json</div>
            <button class="btn small" id="refreshPackages">Refresh</button>
          </div>
        </div>

        <div id="packagesArea" class="card">
          <div id="pkgLoader" class="loading">
            <div class="spinner" aria-hidden="true"></div>
            <div>Loading packages...</div>
          </div>

          <div id="pkgGrid" class="packages-grid" style="margin-top:8px; display:none;"></div>

          <div id="pkgError" style="display:none; color:#ffb4d3; padding:12px; border-radius:8px; background:rgba(255,255,255,0.02); margin-top:10px;">
            Could not load packages. Try refreshing or check CORS from the hosting server.
          </div>
        </div>
      </section>

      <!-- ABOUT -->
      <section id="about" class="panel" role="tabpanel" aria-labelledby="tab-about" hidden>
        <div class="card">
          <h2 style="margin:0 0 10px 0">About NovaOS</h2>
          <p class="muted">
            NovaOS is a community-driven OS replacement for CraftOS style environments. It uses a simple package format (JSON) served from static hosting
            so package authors can publish easily. This website is a simple package browser + quick installer helper.
          </p>

          <h3 style="margin-top:14px">Package JSON format</h3>
          <p class="muted" style="margin:6px 0 0 0">
            Expected fields per package (examples):
          </p>
          <pre style="background:rgba(0,0,0,0.28); padding:10px; border-radius:8px; color:var(--muted); overflow:auto;">
[
  {
    "name": "example-pkg",
    "description": "Short description of package",
    "image": "https://example.com/icon.png",
    "preview": "https://example.com/preview.png"
  }
]
          </pre>
        </div>
      </section>
    </main>

    <footer>
      <div>NovaOS — package browser</div>
      <div class="muted">Built with ❤️ · Purple theme</div>
    </footer>
  </div>

  <!-- Copy toast -->
  <div id="toast" class="copy-toast" style="display:none;" role="status" aria-live="polite">
    <div id="toastText">Copied!</div>
  </div>

  <script>
    // Accessibility: simple tab switching
    (function(){
      const tabs = document.querySelectorAll('.tab');
      const panels = document.querySelectorAll('.panel');

      function switchTab(target){
        tabs.forEach(t => {
          const sel = t.dataset.tab === target;
          t.setAttribute('aria-selected', sel ? 'true' : 'false');
          document.getElementById(t.dataset.tab).hidden = !sel;
        });
      }

      tabs.forEach(t => {
        t.addEventListener('click', () => switchTab(t.dataset.tab));
        t.addEventListener('keydown', (e) => {
          if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); switchTab(t.dataset.tab); }
        });
      });

      // default
      switchTab('home');

      // Buttons
      document.getElementById('showPackagesBtn').addEventListener('click', () => {
        switchTab('packages');
        document.getElementById('tab-packages').focus();
      });

      // Install copy and open
      const installEl = document.getElementById('installCmd');
      document.getElementById('copyInstall').addEventListener('click', () => copyText(installEl.textContent.trim()));
      document.getElementById('openInstall').addEventListener('click', () => {
        window.open(installEl.textContent.trim(), '_blank', 'noopener');
      });

      document.getElementById('copyQuick').addEventListener('click', () => {
        copyText('nam -i <pkg>');
      });

      function showToast(msg='Copied!'){
        const toast = document.getElementById('toast');
        const ttext = document.getElementById('toastText');
        ttext.textContent = msg;
        toast.style.display = 'flex';
        clearTimeout(window._toastT);
        window._toastT = setTimeout(()=> toast.style.display = 'none', 2200);
      }

      async function copyText(text){
        try{
          await navigator.clipboard.writeText(text);
          showToast('Copied to clipboard');
        }catch(e){
          // fallback
          const ta = document.createElement('textarea');
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          try { document.execCommand('copy'); showToast('Copied to clipboard'); } catch(err){ alert('Copy failed: ' + err) }
          ta.remove();
        }
      }

      // Packages fetching logic
      const PACKAGES_URL = 'https://fozogt-jpg.github.io/NovaShell/packages/npkg.json';
      const pkgGrid = document.getElementById('pkgGrid');
      const pkgLoader = document.getElementById('pkgLoader');
      const pkgError = document.getElementById('pkgError');
      const refreshBtn = document.getElementById('refreshPackages');

      async function loadPackages(){
        pkgGrid.innerHTML = '';
        pkgLoader.style.display = 'flex';
        pkgGrid.style.display = 'none';
        pkgError.style.display = 'none';

        try{
          const resp = await fetch(PACKAGES_URL, { mode: 'cors', cache: 'no-store' });
          if(!resp.ok) throw new Error('Network response was not ok: ' + resp.status);
          const data = await resp.json();

          // Expecting an array
          if(!Array.isArray(data)) throw new Error('Package JSON must be an array.');

          if(data.length === 0){
            pkgLoader.style.display = 'none';
            pkgError.style.display = 'block';
            pkgError.textContent = 'No packages available.';
            return;
          }

          // Build cards
          data.forEach(pkg => {
            // tolerate different key names; normalize
            const name = pkg.name || pkg.nam || pkg.id || 'unknown';
            const description = pkg.description || pkg.desc || pkg.short || 'No description provided.';
            const image = pkg.image || pkg.icon || '';
            const preview = pkg.preview || pkg.screenshot || '';

            const card = document.createElement('article');
            card.className = 'pkg-card';
            card.setAttribute('tabindex', '0');
            card.innerHTML = `
              <div class="pkg-thumb" aria-hidden="false">
                ${ image ? `<img src="${escapeHtml(image)}" alt="${escapeHtml(name)} icon" loading="lazy">` :
                `<div style="color:var(--muted); font-size:0.9rem; padding:12px">No image</div>`}
              </div>
              <div class="pkg-title">
                <h3>${escapeHtml(name)}</h3>
                <div class="muted" title="Package name">${escapeHtml(name)}</div>
              </div>
              <p class="pkg-desc">${escapeHtml(description)}</p>
              <div style="display:flex; gap:8px; margin-top:auto;" class="pkg-actions">
                <button class="btn small install-btn" data-pkg="${escapeHtmlAttribute(name)}">Copy install</button>
                ${ preview ? `<button class="btn small preview-btn" data-preview="${escapeHtmlAttribute(preview)}">Preview</button>` : '' }
                <button class="btn small" data-copyname="${escapeHtmlAttribute(name)}">Copy name</button>
              </div>
            `;
            pkgGrid.appendChild(card);
          });

          // wire up buttons
          pkgGrid.querySelectorAll('.install-btn').forEach(b => {
            b.addEventListener('click', (e) => {
              const pkg = e.currentTarget.dataset.pkg;
              copyText(`nam -i ${pkg}`);
            });
          });

          pkgGrid.querySelectorAll('.preview-btn').forEach(b => {
            b.addEventListener('click', (e) => {
              const url = e.currentTarget.dataset.preview;
              window.open(url, '_blank', 'noopener');
            });
          });

          pkgGrid.querySelectorAll('[data-copyname]').forEach(b => {
            b.addEventListener('click', (e) => {
              copyText(e.currentTarget.dataset.copyname);
            });
          });

          pkgLoader.style.display = 'none';
          pkgGrid.style.display = 'grid';
        }catch(err){
          console.error('Packages fetch failed', err);
          pkgLoader.style.display = 'none';
          pkgGrid.style.display = 'none';
          pkgError.style.display = 'block';
          pkgError.textContent = 'Could not load packages: ' + (err && err.message ? err.message : 'unknown error') + '. Check network/CORS.';
        }
      }

      refreshBtn.addEventListener('click', loadPackages);

      // load on first reveal of packages
      document.getElementById('tab-packages').addEventListener('click', loadPackages);

      // helper escaping
      function escapeHtml(str){
        if(!str && str !== 0) return '';
        return String(str)
          .replaceAll('&','&amp;')
          .replaceAll('<','&lt;')
          .replaceAll('>','&gt;')
          .replaceAll('"','&quot;')
          .replaceAll("'", '&#39;');
      }
      function escapeHtmlAttribute(str){
        return escapeHtml(str).replaceAll('"','&quot;');
      }

      // attempt to prefetch packages on load in background (best-effort)
      // We will not throw visible errors until user opens packages.
      (async function prefetch(){
        try{
          await fetch(PACKAGES_URL, { mode:'cors', cache: 'no-store' });
        }catch(e){}
      })();

      // keyboard: left/right to switch tabs
      document.addEventListener('keydown', (e)=>{
        const order = ['home','packages','about'];
        let currentIndex = order.findIndex(k => !document.getElementById(k).hidden);
        if(e.key === 'ArrowRight'){
          currentIndex = (currentIndex + 1) % order.length;
          switchTab(order[currentIndex]);
        } else if(e.key === 'ArrowLeft'){
          currentIndex = (currentIndex - 1 + order.length) % order.length;
          switchTab(order[currentIndex]);
        }
      });

    })();
  </script>
</body>
</html>
