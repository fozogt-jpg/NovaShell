<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NovaOS — Simple Package Store</title>
  <style>
    :root{
      --bg-900:#170218;
      --panel:#23042a;
      --accent-700:#5b2a84;
      --accent-600:#7b4aae;
      --accent-500:#9b6fe0;
      --muted:#d8d3ea;
      --card-bg: rgba(255,255,255,0.02);
      --glass: rgba(255,255,255,0.02);
      --radius:12px;
      --shadow: 0 12px 36px rgba(6,2,18,0.7);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-900) 0%, #0f0510 78%);color:var(--muted);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .wrap{max-width:1100px;margin:28px auto;padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.03)}

    header{display:flex;align-items:center;gap:12px;padding:12px 10px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .logo{display:flex;gap:12px;align-items:center}
    .mark{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent-700),var(--accent-500));display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-family:monospace;font-size:18px}
    .brand h1{margin:0;color:white;font-size:1.05rem}
    .brand p{margin:0;color:var(--muted);font-size:0.88rem}

    nav.top-tabs{margin-left:auto;display:flex;gap:8px}
    .tab{padding:8px 12px;border-radius:10px;background:transparent;color:var(--muted);border:1px solid transparent;cursor:pointer;font-weight:700}
    .tab[aria-selected="true"]{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:white;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 26px rgba(40,12,60,0.22)}

    main{padding:18px;display:grid;gap:20px}

    /* Home: single textbox with copy in corner */
    .home-card{padding:18px;border-radius:12px;background:var(--card-bg);border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:12px}
    .installer-wrap{position:relative}
    .installer-txt{
      background:rgba(0,0,0,0.32);
      padding:14px 16px;
      border-radius:10px;
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      color:white;
      overflow-wrap:anywhere;
      min-width:0;
    }
    .copy-corner{
      position:absolute;
      right:10px;
      top:10px;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .copy-btn{
      background:linear-gradient(90deg,var(--accent-600),var(--accent-500));
      color:white;border:none;padding:8px 10px;border-radius:8px;font-weight:800;cursor:pointer;
    }
    .open-btn{
      background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700;margin-left:6px;
    }

    /* Packages: image then name only in grid */
    .packages-card{padding:12px;border-radius:12px;background:var(--card-bg);border:1px solid rgba(255,255,255,0.03)}
    .pkg-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
    .pkg-tile{
      background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;align-items:stretch;cursor:pointer;
      transition:transform 120ms ease;
      min-height:200px;
    }
    .pkg-tile:focus-within,.pkg-tile:hover{transform:translateY(-6px)}
    .pkg-image{height:140px;background:var(--glass);display:flex;align-items:center;justify-content:center;border-bottom:1px solid rgba(255,255,255,0.02)}
    .pkg-image img{max-width:100%;max-height:100%;object-fit:contain;display:block}
    .pkg-name{padding:10px 12px;font-weight:800;color:white;text-align:left}

    .muted{color:var(--muted)}

    /* Modal / details */
    .backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:9999;padding:20px}
    .modal{width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:16px;display:flex;gap:14px;align-items:flex-start;border:1px solid rgba(255,255,255,0.03)}
    .modal img.preview{max-width:420px;width:40%;border-radius:8px;object-fit:contain;border:1px solid rgba(255,255,255,0.02)}
    .modal .meta{flex:1;min-width:220px}
    .modal h2{margin:0;color:white}
    .modal p.desc{margin:8px 0 12px 0;color:var(--muted);line-height:1.45}
    .thumb-row{display:flex;gap:8px;align-items:center;margin-top:10px}
    .thumb-row img{width:72px;height:56px;border-radius:6px;object-fit:contain;border:1px solid rgba(255,255,255,0.02)}
    .install-action{display:flex;gap:8px;margin-top:12px}
    .install-primary{background:linear-gradient(90deg,var(--accent-600),var(--accent-500));color:white;border:none;padding:10px 12px;border-radius:8px;font-weight:800;cursor:pointer}
    .install-outline{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);padding:9px 10px;border-radius:8px;cursor:pointer}

    .toast{position:fixed;right:20px;bottom:20px;display:none;background:linear-gradient(90deg,var(--accent-700),var(--accent-500));color:white;padding:10px 14px;border-radius:999px;font-weight:700;z-index:10001}

    @media (max-width:780px){
      .modal{flex-direction:column;align-items:center}
      .modal img.preview{width:80%;max-width:80%}
      .thumb-row img{width:60px;height:46px}
      .pkg-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr))}
    }
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="NovaOS simple store">
    <header>
      <div class="logo" aria-hidden="false">
        <div class="mark">N</div>
        <div class="brand">
          <h1>NovaOS</h1>
          <p class="muted">Official NovaOS packages — for ComputerCraft</p>
        </div>
      </div>

      <nav class="top-tabs" role="tablist" aria-label="Main tabs">
        <button class="tab" data-tab="home" aria-selected="true" id="tab-home">Home</button>
        <button class="tab" data-tab="packages" aria-selected="false" id="tab-packages">Packages</button>
      </nav>
    </header>

    <main>
      <!-- HOME (single textbox with copy in corner) -->
      <section id="home" class="home-card" role="tabpanel" aria-labelledby="tab-home">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <h2 style="margin:0;color:white">NovaOS installer</h2>
        </div>

        <div class="installer-wrap" aria-hidden="false">
          <div id="installerTxt" class="installer-txt" tabindex="0">wget https://fozogt-jpg.github.io/NovaShell/install</div>
          <div class="copy-corner">
            <button id="copyInstaller" class="copy-btn" title="Copy installer command">Copy</button>
            <button id="openInstaller" class="open-btn" title="Open installer URL">Open</button>
          </div>
        </div>

        <div class="muted" style="font-size:0.95rem">Primary action for ComputerCraft: install &lt;package&gt; (copy from package details).</div>
      </section>

      <!-- PACKAGES -->
      <section id="packages" class="packages-card" role="tabpanel" aria-labelledby="tab-packages" hidden>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div>
            <h2 style="margin:0;color:white">Packages</h2>
            <div class="muted" style="font-size:0.92rem">Source: https://fozogt-jpg.github.io/NovaShell/packages/npkg.json</div>
          </div>
          <div style="display:flex;gap:8px">
            <button id="refreshBtn" class="install-outline">Refresh</button>
          </div>
        </div>

        <div id="pkgGrid" class="pkg-grid" aria-live="polite">
          <!-- Tiles will be injected here: image then name only -->
        </div>

        <div id="pkgLoading" class="muted" style="margin-top:12px;display:none">Loading packages...</div>
        <div id="pkgError" style="margin-top:12px;color:#ffb4d3;display:none"></div>
      </section>
    </main>
  </div>

  <!-- Details modal -->
  <div id="backdrop" class="backdrop" aria-hidden="true" role="dialog">
    <div class="modal" role="document" aria-label="Package details">
      <div style="width:100%;display:flex;justify-content:flex-end;"><button id="closeModal" class="install-outline">Close</button></div>

      <img id="modalPreview" class="preview" src="" alt="Preview image" />

      <div class="meta">
        <h2 id="modalName">Package name</h2>
        <p id="modalDesc" class="desc">Package description</p>

        <div style="font-size:0.92rem;color:var(--muted)">Images</div>
        <div class="thumb-row" id="thumbRow" aria-hidden="false" style="margin-bottom:6px">
          <!-- thumbnail images inserted here -->
        </div>

        <div class="install-action">
          <button id="modalInstall" class="install-primary">Copy install</button>
          <button id="modalPreviewOpen" class="install-outline">Open preview in new tab</button>
        </div>

        <div style="margin-top:12px">
          <div style="color:var(--muted);font-weight:700;margin-bottom:6px">Install command</div>
          <div id="modalCmd" class="install-outline" style="padding:10px;border-radius:8px;font-family:ui-monospace,monospace;color:white;background:rgba(0,0,0,0.24);word-break:break-word"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">Copied</div>

  <script>
    (function(){
      const PACKAGES_URL = 'https://fozogt-jpg.github.io/NovaShell/packages/npkg.json';

      // Tabs
      const tabs = document.querySelectorAll('.tab');
      function switchTab(key){
        tabs.forEach(t => {
          const sel = t.dataset.tab === key;
          t.setAttribute('aria-selected', sel ? 'true' : 'false');
          const panel = document.getElementById(t.dataset.tab);
          if(panel) panel.hidden = !sel;
        });
      }
      tabs.forEach(t => {
        t.addEventListener('click', ()=> switchTab(t.dataset.tab));
        t.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); switchTab(t.dataset.tab); }});
      });
      switchTab('home');

      // Installer copy/open
      const installerTxt = document.getElementById('installerTxt');
      document.getElementById('copyInstaller').addEventListener('click', ()=> copyText(installerTxt.textContent.trim()));
      document.getElementById('openInstaller').addEventListener('click', ()=> window.open(installerTxt.textContent.trim(), '_blank', 'noopener'));

      // Toast helper
      const toast = document.getElementById('toast');
      let toastT;
      function showToast(msg='Copied'){
        toast.textContent = msg;
        toast.style.display = 'block';
        clearTimeout(toastT);
        toastT = setTimeout(()=> toast.style.display = 'none', 1800);
      }

      async function copyText(text){
        if(!text) return;
        try{
          await navigator.clipboard.writeText(text);
          showToast('Copied to clipboard');
        }catch(e){
          // fallback
          const ta = document.createElement('textarea');
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          try { document.execCommand('copy'); showToast('Copied to clipboard'); } catch(err){ alert('Copy failed: ' + err); }
          ta.remove();
        }
      }

      // Packages
      const pkgGrid = document.getElementById('pkgGrid');
      const pkgLoading = document.getElementById('pkgLoading');
      const pkgError = document.getElementById('pkgError');
      const refreshBtn = document.getElementById('refreshBtn');
      let packages = [];

      async function loadPackages(){
        pkgGrid.innerHTML = '';
        packages = [];
        pkgLoading.style.display = 'block';
        pkgError.style.display = 'none';
        try{
          const res = await fetch(PACKAGES_URL, { mode: 'cors', cache: 'no-store' });
          if(!res.ok) throw new Error('Network response ' + res.status);
          const json = await res.json();
          if(!Array.isArray(json)) throw new Error('Package file must be a JSON array.');
          packages = json;

          if(packages.length === 0){
            pkgLoading.style.display = 'none';
            pkgError.style.display = 'block';
            pkgError.textContent = 'No packages available.';
            return;
          }

          packages.forEach((pkg, idx) => {
            const name = pkg.name || pkg.id || 'unknown';
            const img = pkg.image || pkg.icon || '';
            const tile = document.createElement('article');
            tile.className = 'pkg-tile';
            tile.setAttribute('tabindex','0');
            tile.innerHTML = `
              <div class="pkg-image" data-idx="${idx}" title="Open details for ${escapeHtml(name)}">
                ${ img ? `<img src="${escapeAttr(img)}" alt="${escapeHtml(name)} image" loading="lazy">` : `<div style="padding:12px;color:var(--muted)">No image</div>` }
              </div>
              <div class="pkg-name">${escapeHtml(name)}</div>
            `;
            pkgGrid.appendChild(tile);
          });

          // wire clicks (image or tile)
          pkgGrid.querySelectorAll('.pkg-image').forEach(el => {
            el.addEventListener('click', ()=> { const idx = Number(el.dataset.idx); openModal(idx); });
            el.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); const idx = Number(el.dataset.idx); openModal(idx); }});
          });
          // also allow entire tile click (for accessibility)
          pkgGrid.querySelectorAll('.pkg-tile').forEach((tile, i) => {
            tile.addEventListener('click', (e)=> {
              // if click wasn't on an actionable child, open modal
              if(e.target.closest('.pkg-image') || e.target.closest('.pkg-name')) {
                const idxEl = tile.querySelector('.pkg-image');
                if(idxEl) openModal(Number(idxEl.dataset.idx));
              }
            });
          });

          pkgLoading.style.display = 'none';
        }catch(err){
          console.error('Load packages failed', err);
          pkgLoading.style.display = 'none';
          pkgError.style.display = 'block';
          pkgError.textContent = 'Could not load packages: ' + (err && err.message ? err.message : 'unknown') + '. If you see CORS errors the host must enable CORS.';
        }
      }

      refreshBtn.addEventListener('click', loadPackages);
      document.getElementById('tab-packages').addEventListener('click', loadPackages);

      // Modal elements
      const backdrop = document.getElementById('backdrop');
      const modalPreview = document.getElementById('modalPreview');
      const modalName = document.getElementById('modalName');
      const modalDesc = document.getElementById('modalDesc');
      const thumbRow = document.getElementById('thumbRow');
      const modalCmd = document.getElementById('modalCmd');
      const modalInstall = document.getElementById('modalInstall');
      const modalPreviewOpen = document.getElementById('modalPreviewOpen');
      const closeModalBtn = document.getElementById('closeModal');

      function openModal(idx){
        const pkg = packages[idx];
        if(!pkg) return;
        const name = pkg.name || pkg.id || 'unknown';
        const description = pkg.description || pkg.desc || 'No description provided.';
        const image = pkg.image || pkg.icon || '';
        const preview = pkg.preview || pkg.screenshot || '';
        const install_cmd = pkg.install_cmd || `install ${name}`;

        modalName.textContent = name;
        modalDesc.textContent = description;
        modalCmd.textContent = install_cmd;
        modalPreview.src = preview || image || '';
        modalPreview.alt = name + ' preview';

        // thumbnails: show provided image and preview if both exist (de-duplicate)
        thumbRow.innerHTML = '';
        const thumbs = [];
        if(image) thumbs.push({src:image, alt: name + ' image'});
        if(preview && preview !== image) thumbs.push({src:preview, alt: name + ' preview'});
        if(thumbs.length === 0){
          thumbRow.innerHTML = '<div style="color:var(--muted)">No additional images</div>';
        } else {
          thumbs.forEach(t => {
            const img = document.createElement('img');
            img.src = t.src;
            img.alt = t.alt;
            img.loading = 'lazy';
            img.tabIndex = 0;
            img.style.cursor = 'pointer';
            img.addEventListener('click', ()=> {
              modalPreview.src = t.src;
              modalPreview.alt = t.alt;
            });
            img.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); modalPreview.src = t.src; modalPreview.alt = t.alt; }});
            thumbRow.appendChild(img);
          });
        }

        modalInstall.onclick = ()=> copyText(install_cmd);
        modalPreviewOpen.onclick = ()=> {
          const url = preview || image || '';
          if(url) window.open(url, '_blank', 'noopener');
        };

        backdrop.style.display = 'flex';
        backdrop.setAttribute('aria-hidden','false');
        closeModalBtn.focus();
      }

      function closeModal(){
        backdrop.style.display = 'none';
        backdrop.setAttribute('aria-hidden','true');
        modalPreview.src = '';
      }

      closeModalBtn.addEventListener('click', closeModal);
      backdrop.addEventListener('click', (e)=> { if(e.target === backdrop) closeModal(); });
      document.addEventListener('keydown', (e)=> {
        if(e.key === 'Escape') {
          if(backdrop.style.display === 'flex') closeModal();
        }
        // left/right to switch tabs
        const order = ['home','packages'];
        let currentIndex = order.findIndex(k => !document.getElementById(k).hidden);
        if(e.key === 'ArrowRight'){ currentIndex = (currentIndex + 1) % order.length; switchTab(order[currentIndex]); }
        if(e.key === 'ArrowLeft'){ currentIndex = (currentIndex - 1 + order.length) % order.length; switchTab(order[currentIndex]); }
      });

      // simple escaping helpers
      function escapeHtml(s){ if(s===null||s===undefined) return ''; return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
      function escapeAttr(s){ return escapeHtml(String(s)).replace(/"/g,'&quot;'); }

      // initial prefetch (best-effort)
      (async ()=> { try{ await fetch(PACKAGES_URL, { mode:'cors' }); }catch(e){} })();

      // load on startup
      // packages will load when user clicks Packages tab OR we can warm-load now:
      loadPackages();

    })();
  </script>
</body>
</html>
